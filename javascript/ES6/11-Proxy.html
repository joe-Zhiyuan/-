<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ES6-11-Proxy</title>
    <style>
    </style>
</head>
<body>

</body>
<script type="text/javascript">
    // 概述 代理器  代理某些操作   对外界的访问进行过滤和改写
    //对空对象进行一层拦截，重新定义属性的读取(get)和设置(set)  读取设置了拦截行为的对象obj的属性
    var obj = new Proxy({},{
        get :function(target,key,receiver){
            console.log(`getting ${key}!`);
            return Reflect.get(target,key,receiver);
        },
        set :function(target,key,value,receiver){
            console.log(`setting ${key}!`);
            return Reflect.set(target,key,value,receiver);
        }
    });
    obj.count = 1;
    console.log(++obj.count);//2   getting count!  setting count!
    //拦截属性  拦截目标get访问请求  返回35   如果target={} handler={}等于访问target
    var proxy = new Proxy({},{
        get: function(target,property){
            return 35;
        }
    });
    console.log(proxy.time);//35
    console.log(proxy.name);//35
    let target = {},
        handler = {};
    var proxy1 = new Proxy(target,handler);
    proxy1.a = "b";
    console.log(target.a);//"b"
    // 将Proxy对象设置到object.proxy属性上，从而在Object上调用
    let object = {proxy:new Proxy(target, handler) };
    // Proxy实例可以作为其他对象的原型对象   同一个拦截器可以设置多个操作
    let proxy2 = new Proxy({},{
        get: function(target,property){
            return 35;
        },
        apply: function(target, thisBinding, args){
            return args[0];
        }
    });
    let obj1 = Object.create(proxy2);
    console.log(obj1.name);//35

    //Proxy实例的方法
    // get() 拦截某个属性读取操作 可以继承
    var person = {
        name: "张三"
    };
    var proxy3 = new Proxy(person, {
        get:function(target, property){
            if(property in target){
                return target[property];
            }else{
                throw new ReferenceError("Property\""+property+"\" does not exist.");
            }
        }
    });
    console.log(person.name);//"张三"
    console.log(person.age);//undefined   不存在属性，返回undefined
    let proto = new Proxy({}, {
        get(target, propertyKey, receiver){
            console.log("GET"+propertyKey);
            return target[propertyKey];
        }
    });
    let obj2 = Object.create(proto);
    obj2.xxx;//GET xxx
    // get()实现数组读取负数索引
    function createArray(...elements){
        let handler = {
            get(target, propKey, receiver){
                let index = Number(propKey);
                if(index<0){
                    propKey = String(target.length + index);
                }
                return Reflect.get(target, propKey, receiver);
            }
        };
        let target = [];
        target.push(...elements);
        return new Proxy(target, handler);
    }
    let arr = createArray("a","b","c");
    console.log(arr[-1]);//"c"
</script>
</html>