<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>高程3-8-高级技巧</title>
</head>
<style>

</style>
<body>
    <p title="123145"> 123</p>
    <div id="myDiv"></div>
</body>
<script>
    //测试构造函数名
    var type1 = new Array();
    console.log(Object.prototype.toString.call(type1));
    //是否原生函数
    function isFunction(value){
        return Object.prototype.toString.call(value) === "[Object function]";
    }
    //是否正则表达式
    function isRegExp(value){
        return Object.prototype.toString.call(value) === "[Object RegExp]";
    }
    //创建一个作用域安全的构造函数 防止不写new
    function Person(name,job,age){
        if(this instanceof Person){
            this.name = name;
            this.job = job;
            this.age = age;
        }else{
            return new Person(name,job,age);
        }
    }
    var person1 = Person("joe","internet",22);
    console.log(window.name);// ""
    console.log(person1.name);// joe
    var person2 = new Person("qiao","it","21");
    console.log(person2.name);

    //a的值不变
    var a = 10;
    function foo(b){
        b = b+20;
        return b;
    }
    foo(a);
    console.log(a);
    console.log(foo(a));//30
    //闭包
    function Fun(){
        var c = "joe";
        function sayName(){
            console.log(c);
        }
        return sayName;
    }
    var Fun1 = Fun();
    Fun1();//能访问  c

    function makeAdder(x){
        return function(y){
            return x + y;
        }
    }
    var add5 = makeAdder(5);
    var add10 = makeAdder(10);

    console.log(add5(2));
    console.log(add10(2));

    //数据绑定
    var d = 10;
    var module = {
      d : 99,
      getD: function(){
          return this.d;
      }
    };
    console.log(module.getD());//99
    var getD2 = module.getD;
    console.log(getD2());//10  指向全局对象
    var getD3 = getD2.bind(module);
    console.log(getD3());//99 绑定了作用域

    //不可扩展对象
    var person = {
        name : "joe"
    };
    Object.preventExtensions(person);
    person.age = 23;//undefined 无效
    console.log(person.age);
    person.name = "qiao";
    console.log(person.name);//可修改
    //密封对象
    Object.seal(person);
    delete person.name;//被忽略  删除person.name
    console.log(person.name);
    //冻结对象
    Object.freeze(person);
    person.age = 23;//undefined 无效
    console.log(person.age);
    person.name = "joe--";
    console.log(person.name);//qiao 无法修改

    //数组分块  可以为分页应用
    function chunk(array,process,num,context){
        setTimeout(function() {
            //num是表示截取多少为一组
            var item = array.splice(0,num);
            process.call(context,item);

            if(array.length > 0){
                setTimeout(arguments.callee,100);
            }
        },100);
    }
    var data = [12,123,14123131,14,1,5,13,1,12,35,1,51,6,4,8,19,1,3,13,35,6,51,2];
    function printValue(item){
        var div = document.getElementById("myDiv");
        div.innerHTML = item + "<br>";
    }
    chunk(data.concat(),printValue,3);

    //自定义事件
    function EventTarget(){
        this.handlers = {};
    }
    EventTarget.prototype = {
        constructor:EventTarget,
        addHandler: function(type,handler){
            if(typeof this.handlers[type] === "undefined"){
                this.handlers[type] = [];
            }
            this.handlers[type].push(handler);
        },

        fire: function(event){
            if(!event.target){
                event.target = this;
            }
            if(this.handlers[event.type] instanceof Array){
                var handlers = this.handlers[event.type];
                for(var i=0, len=handlers.length; i<len; i++){
                    handlers[i](event);
                }
            }
        },

        removeHandler: function(type, handler){
            if(this.handlers[type] instanceof Array){
                var handlers = this.handlers[type];
                for(var i=0, len=handlers.length; i<len; i++){
                    if(handlers[i] === handler){
                        break;
                    }
                }
                handlers.splice(i,1);
            }
        }
    };

    //定义事件
    function handleMessage(event){
        console.log("Message received:" + event.message);
    }
    //创建新对象
    var target = new EventTarget();
    //添加事件处理程序
    target.addHandler("message",handleMessage);
    //触发事件
    target.fire({type:"message",message:"hello"});
    //删除事件
    target.removeHandler("message",handleMessage);
    //再次应没有程序
    target.fire({type:"message",message:"hello"});
</script>
</html>